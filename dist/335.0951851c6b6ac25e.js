"use strict";(self.webpackChunkemisora=self.webpackChunkemisora||[]).push([[335],{1335:(H,u,s)=>{s.r(u),s.d(u,{HomeModule:()=>P});var g=s(6895),a=s(8869),t=s(4650),m=s(1436),d=s(529);let p=(()=>{class n{constructor(e){this.httpClient=e,this.urlBase=m.N.apiUrl}getNextSong(e){const o={"X-AUTH-TOKEN":atob(localStorage.getItem("token-session")||"")??!1};return this.httpClient.get(`${this.urlBase}/player/next/${e}`,{headers:o})}logSong(e,i,o){const M={"X-AUTH-TOKEN":atob(localStorage.getItem("token-session")||"")??!1,"Content-Type":"application/json"};return this.httpClient.post(`${this.urlBase}/song/history`,JSON.stringify({title:e.title,author:e.albumartist,song_id:e.self.id,pos_id:o}),{headers:M})}validateSong(e){return this.httpClient.get(e)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(d.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var f=s(49),l=s(4366);const _=["audioPlayer"];function h(n,r){1&n&&(t.TgZ(0,"div",7)(1,"p"),t._uU(2,"Hubo un error al cargar el audio, por favor validar el automatizador"),t.qZA()())}function v(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-icon",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.onPlay())}),t._uU(1,"play_circle_outline"),t.qZA()}}function x(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"mat-icon",19),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.onPuase())}),t._uU(1,"pause"),t.qZA()}}function C(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"audio",8,9),t.NdJ("timeupdate",function(o){t.CHM(e);const c=t.oxw();return t.KtG(c.updateTime(o))})("ended",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.finishSong())}),t._UZ(3,"source",10),t.qZA(),t.TgZ(4,"div",11)(5,"div",12),t.YNc(6,v,2,0,"mat-icon",13),t.YNc(7,x,2,0,"mat-icon",13),t._UZ(8,"img",14),t.TgZ(9,"div",15)(10,"p")(11,"strong"),t._uU(12),t.qZA()(),t.TgZ(13,"p",16),t._uU(14),t.qZA()()(),t.TgZ(15,"div",12)(16,"mat-icon",17),t._uU(17,"equalizer"),t.qZA(),t.TgZ(18,"div",18),t._uU(19),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("src",e.nextSong.url,t.LSH),t.xp6(3),t.Q6J("ngIf",!e.isListen),t.xp6(1),t.Q6J("ngIf",e.isListen),t.xp6(1),t.Q6J("src",e.nextSong.art,t.LSH),t.xp6(4),t.Oqu(e.nextSong.name),t.xp6(2),t.Oqu(e.nextSong.artist.name),t.xp6(5),t.Oqu(e.currentTime)}}let S=(()=>{class n{constructor(e,i,o){this.songService=e,this.router=i,this.userService=o,this.nextSong={},this.currentTime="0:00",this.isListen=!1}ngOnInit(){this.currentUser=this.getLocalStorage("user-session",!0),this.currentCustomer=this.getLocalStorage("point-of-sale",!0),this.songService.getNextSong(this.currentUser.punto_de_venta).subscribe(e=>{200==e.code&&(this.nextSong=e.payload.song)},e=>{500==e.status&&this.exitUser()})}updateTime(e){this.currentTime=this.convertTime(e.srcElement.currentTime)}getLocalStorage(e,i=!1){let o=localStorage.getItem(e);return i&&(o=JSON.parse(atob(localStorage.getItem(e)||"{}"))),o}onPlay(){this.audioPlayer?.nativeElement.play(),this.isListen=!0,this.songService.logSong(this.nextSong,this.currentCustomer.id,this.currentUser.punto_de_venta).subscribe(i=>{})}onPuase(){this.audioPlayer?.nativeElement.pause(),this.isListen=!1}finishSong(){this.songService.getNextSong(this.currentUser.punto_de_venta).subscribe(e=>{200==e.code&&(this.nextSong=e,this.onPlay())},e=>{500==e.status&&this.exitUser()})}convertTime(e){const i=Math.floor(e/60),o=Math.floor(e%60);return`${i}:${o<10?"0":""}${o}`}exitUser(){localStorage.clear(),this.router.navigateByUrl("/login")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p),t.Y36(a.F0),t.Y36(f.r))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-home"]],viewQuery:function(e,i){if(1&e&&t.Gf(_,5),2&e){let o;t.iGM(o=t.CRH())&&(i.audioPlayer=o.first)}},decls:13,vars:4,consts:[[1,"page-home"],[1,"main-content"],[1,"menu-navigation"],[1,"title"],[1,"user-actions"],[1,"icon-exit",3,"click"],["class","widget-music",4,"ngIf"],[1,"widget-music"],["controls","","hidden","",3,"timeupdate","ended"],["audioPlayer",""],["type","audio/mpeg",3,"src"],[1,"container-musis"],[1,"item-row"],[3,"click",4,"ngIf"],["width","60","height","60",3,"src"],[1,"info-text"],[1,"text-cort"],[1,"equalizer"],[1,"time"],[3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1"),t._uU(5,"Player Web"),t.qZA()(),t.TgZ(6,"div",4)(7,"p"),t._uU(8),t.qZA(),t.TgZ(9,"mat-icon",5),t.NdJ("click",function(){return i.exitUser()}),t._uU(10,"exit_to_app"),t.qZA()()(),t.YNc(11,h,3,0,"div",6),t.YNc(12,C,20,7,"div",6),t.qZA()()),2&e&&(t.xp6(8),t.AsE("",i.currentUser.nombre," ",i.currentUser.apellido,""),t.xp6(3),t.Q6J("ngIf",i.nextSong.error),t.xp6(1),t.Q6J("ngIf",i.nextSong.url))},dependencies:[g.O5,l.Hw],styles:[".page-home[_ngcontent-%COMP%]{height:100svh}.page-home[_ngcontent-%COMP%]   .main-content[_ngcontent-%COMP%]{flex-direction:column;display:flex}.widget-music[_ngcontent-%COMP%]{display:flex;width:100%;height:100%;align-items:center;background-image:url(bg-found.ef02631ac380d3fa.jpeg);background-size:cover;background-position-x:right;background-position-y:top}.container-musis[_ngcontent-%COMP%]{background-color:#3c929f;color:#fff;display:flex;width:100%;margin:0 2rem;border-radius:10px;overflow:hidden;align-items:center;padding:1rem 2rem;justify-content:space-between}.container-musis[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin:0 1rem}.container-musis[_ngcontent-%COMP%]   .item-row[_ngcontent-%COMP%]{display:flex;align-items:center}.container-musis[_ngcontent-%COMP%]   .text-cort[_ngcontent-%COMP%]{font-size:12px}.container-musis[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.container-musis[_ngcontent-%COMP%]   .equalizer[_ngcontent-%COMP%]{margin-right:5px}.menu-navigation[_ngcontent-%COMP%]{background-color:#3c929f;color:#fff;display:flex;justify-content:space-between;align-items:center;padding:1rem}.menu-navigation[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:26px;margin:0;letter-spacing:0px}.menu-navigation[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]{display:flex;align-items:center}.menu-navigation[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.menu-navigation[_ngcontent-%COMP%]   .user-actions[_ngcontent-%COMP%]   .icon-exit[_ngcontent-%COMP%]{cursor:pointer;margin-left:10px}"]}),n})(),y=(()=>{class n{constructor(e){this.router=e}canActivate(e,i){return this.isLoggedIn()}isLoggedIn(){return!!this.getLocalStorage("token-session")||this.router.navigateByUrl("/login")}getLocalStorage(e){return localStorage.getItem(e)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(a.F0))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),P=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.ez,a.Bz.forChild([{path:"",component:S,canActivate:[y]}]),l.Ps]}),n})()}}]);